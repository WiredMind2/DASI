<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Statistiques | PREDICT'IF</title>
        <link rel="stylesheet" href="employee-styles.css">
    </head>

    <body>
        <header class="header">

            <div class="greeting" id="greeting">Bonjour</div>
            <script>
                document.addEventListener("DOMContentLoaded", async function () {
                    let username = null;
                    const url = "/frontend/ActionServlet/checkConnected";
                    try {
                        const response = await fetch(url);
                        if (!response.ok) {
                            throw new Error(`Response status: ${response.status}`);
                        }

                        username = await response.text();
                    } catch (error) {
                        console.error(error.message);
                    }

                    if (username != null) {
                        document.getElementById('greeting').textContent = 'Bonjour ' + username;
                    } else {

                        document.getElementById('greeting').textContent = 'Bonjour';
                    }
                });
            </script>

            <div class="nav-buttons">
                <button class="nav-button" onclick="window.location.href = 'index.html'">Accueil</button>
                <button class="nav-button" onclick="handleLogout()">Déconnexion</button>
                <script>
                    function handleLogout() {
                        window.location.href = '/frontend/ActionServlet/disconnect';
                    }
                </script>
            </div>
        </header>

        <main class="main-content">
            <div class="stats-container" id="stats-container">
                <!-- Content will be generated by JavaScript -->
            </div>
            <script>
                // Example function to fetch statistics data
                async function fetchStatistics() {
                    // Replace this with your actual data fetching logic
                    return {
                        topMediums: [
                            {denomination: "Medium A", consultations: 42},
                            {denomination: "Medium B", consultations: 37},
                            {denomination: "Medium C", consultations: 29},
                            {denomination: "Medium D", consultations: 21},
                            {denomination: "Medium E", consultations: 18}
                        ],
                        consultationsLast7Days: 153,
                        leaderboard: [
                            {prenom: "Alice", nom: "Dupont", nbClients: 12},
                            {prenom: "Bob", nom: "Martin", nbClients: 10},
                            {prenom: "Claire", nom: "Durand", nbClients: 8},
                            {prenom: "David", nom: "Bernard", nbClients: 7}
                        ]
                    };
                }

                function renderStatistics(stats) {
                    const statsContainer = document.getElementById('stats-container');
                    statsContainer.innerHTML = `
                        <div class="card">
                            <h2 class="card-title">TOP 5 des mediums consultés</h2>
                            <ul class="top-mediums">
                                ${stats.topMediums.map(m => `<li>${m.denomination} - ${m.consultations} consultations</li>`).join('')}
                            </ul>
                            <div class="stats-highlight">
                                Dans les 7 derniers jours nous avons eu: ${stats.consultationsLast7Days} consultations
                            </div>
                        </div>
                        <div class="card">
                            <h2 class="card-title">Leaderboard employe</h2>
                            <div class="leaderboard">
                                ${stats.leaderboard.map(e => `
                                    <div class="leaderboard-item">
                                        <div>${e.prenom} ${e.nom}</div>
                                        <div>${e.nbClients} clients</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                fetchStatistics().then(renderStatistics);
            </script>
        </main>
    </body>

</html>